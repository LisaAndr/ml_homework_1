# ml_homework_1
ML. Homework 1

В данной работе строятся модели для предсказания стоимости автомобиля (selling_price).

Независимые переменные: name, year, km_driven, fuel, seller_type, transmission, owner, mileage, engine, max_power, torque	и seats.

### Перед построением моделей был проведён разведочный анализ данных, включая обработку данных:
1) проанализированы дубликаты в тренировочной и тестовой выборках;
2) построен дашборд с помощью библиотеки ydata-profiling;
3) выяснено, что в столбцах mileage, engine, max_power, torque и seats в обеих выборках есть пропуски, которые впоследствие были заполнены медианой;
4) удалены повторяющиеся строки из тренировочной выборки;
5) обработаны столбцы mileage, engine, max_power и удалён столбец torque в тренировочной и тестовой выборках. Изначально значения переменных mileage, engine, max_power представляли собой строки (например, 23.4 kmpl, 1248 CC, 74 bhp). С помощью регулярного выражение каждый из указанных столбцов был разбит на два столбца: в одном (*_value) стали храниться числовые значения, в другом (*_unit) - единицы измерения. Мы выяснили, что mileage измеряется в kmpl (km/kg встречается всего 77 раз, т. е. является шумом), engine - в CC, max_power - в bhp;
6) столбцы year, selling_price km_driven, engine и seats к приведены к типу int, поскольку целочисленный тип для указанных переменных логичен;
7) построены описательные статистики для числовых и категориальных переменных для тренировочной и тестовой выборок до и после заполнения пропусков числовых переменных (seat, mileage, engine и max_power) мединами. Выяснили, что единственные значения описательной статистики, которые отличаются для этих переменных (до и после заполнения пропусков), - это среднее значение по столбцу, стандартное отклонение и некоторые перцентили (что логично). Но эти значения практически не различаются, значит, на предыдущих шагах мы нигде не ошиблись;
8) с помощью pairplot'a построены распределения признаков, благодаря чему удалось
   * предположить связь признаков с целевой переменной:
     * по графику (x = year, y = selling_price) мы видим, что со временем цена на автомобили растёт, что неудивительно. Очевидно, в 2000 г. (или тем более в 1992 г.) цена на автомобиль была ниже, чем в 2014 г. (в силу курса).
     * график (x = engine, y = selling_price) показывает, что чем больше объём двигателя автомобиля, тем выше стоит автомобиль;
     * по графику (x = max_power, y = selling_price) видно, что чем больше мощность автомобиля (в лошадиных силах), тем больше его цена;
     * график (x = km_driven, y = selling_price) показывает, что чем больше пробег автомобиля, тем меньше он стоит;
     * график (x = mileage, y = selling_price) показывает, что чем больше пробег автомобиля (в км на один литр потребляемого топлива), тем меньше он стоит;
     * по графику (x = seats, y = selling_price) видно, что чем больше мест в автомобиле, тем больше он стоит.
   * выдвинуть гипотезы о корреляциях признаков:
     * линейная положительная связь наблюдается у следующих пар признаков (перечислим только наиболее очевидные, сильные связи): year и mileage, year и selling_price, seats и engine, selling_price и engine, max_power и selling_price, max_power и engine.
     * линейная отрицательная связь наблюдается у следующих пар признаков (перечислим только наиболее очевидные, сильные связи): year и km_driven, seats и mileage, mileage и engine, mileage и max_power.
9) построена тепловая карта на основе коэффициента корреляции Пирсона:
    * наименее скоррелированые между собой признаки - engine и year (corr(engine, year) = 0.0028);
    * между переменными max_power и selling_price, engine и max_power, engine и seats наблюдается довольно сильная положительная линейная зависимость: corr(max_power, selling_price) = 0.69, corr(engine, max_power) = 0.68, corr(engine, seats) = 0.65;
    * убедились в том, что наблюдается отрицальная линейная связь между переменными year и km_driven (corr(year, km_driven) = -0.37). Это соответсвует здравому смыслу: вероятнее всего, чем раньше машина была куплена, тем больше на ней ездили, следовательно, тем больше её пробег.
10) с помощью гистограммы (barplot) проанализировано, как цена продажи автомобиля зависит от типа топлива и типа коробки передач автомобиля:
    * автомобили с автоматической коробкой передач стоят дороже, чем с механической вне зависимости от типа топлива автомобиля;
    * больше всего покупателям придётся заплатить за машину на дизеле c автоматической коробкой передач, меньше всего - на сжиженном нефятном газе (LPG).

 ### Модели
 Всего построено и проанализировано шесть моделей, для каждой из которых посчитаны метрики - R^2 и MSE. Перед их построением данные были разбиты на тренировочную и тестовую выборки.
1) Линейная модель с дефолтными параметрами только на вещественных признаках (включая переменную seats):
   * модель не очень хорошего качества: модель объясняет примерно 60 % вариации цены продажи автомобиля (selling_price) как на тренировочной, так и на тестововой выборке. Практически одинаковый R^2 говорит о том, что модель хорошо
     обобщает на тестовых данных.
   * ошибка модели на тренировочной выборке большая (116601673169.10985), а на тестовой выборке в 2 раза больше, чем на тренировочной (233002359160.8044). MSE указывает на переобучение модели.
3) линейная модель с дефолтными параметрами только на вещественных признаках (включая переменную seats) со стандартизацией.
   * выводы аналогичны, т. к. метрики практически не изменились;
   * max_power (мощность автомобиля в лошадиных силах) - наиболее информативный признак в предсказании цены;
4) Lasso-регрессия c параметрами по умолчанию только на вещественных признаках (включая переменную seats) со стандартизацией:
   * метрики практически не поменялись ни для тренировочной, ни для тестовой выборок (R^2 ~ 0.59, MSE_test ~ 2 * MSE_train);
   * вес ни одного признака не занулился. Объяснения:
     * все признаки, включённые в модель, важны, т. е. они оказывают значимое влияние на цену подажи автомобиля. Благодаря L1-регуляризации происходит естественный отбор признаков модели, т. к. она создаёт разреженные модели, обнуляя
       таким образом веса тех признаков, которые не вносят большого вклада в предсказание целевой переменной;
     * Lasso-модель построена с параметрами по умолчанию, т. е., может быть, регуляризация недостаточно сильная, поэтому модель не занулила признаки.
5) Lasso-регрессия с перебором по сетке (cv = 10). В качестве метрики взята ошибка модели - neg_neg_mean_squared_error:
   * GridSearch'у обучил 60 моделей;
   * лучший параметр - alpha = 100;
   * ни один из весов не занулился;
   * качество предсказания не изменилось.
6) модель ElasticNet с перебором по сетке (cv = 10). В качестве метрики взята ошибка модели - neg_neg_mean_squared_error:
   * GridSearch'у обучил 240 моделей;
   * гиперпараметры, соответствующие лучшей из перебранных моделей - alpha = 0.1, l1_ratio = 0.9;
   * качество модели улучшить не удалось.
Для последней рассметренной Ridge-модели, 
7) Ridge-модель с перебором по сетке (cv = 10). В качестве метрики взята ошибка модели - neg_neg_mean_squared_error. Модель гребниевой регрессии построена на всех признаках -  и на числовых, и на вещественных. Для этого в тренировочной и тестовой выборках был дополнительно предобработан столбец name: первое слово в каждой строке указанного столбца - марка автомобиля, следом написаны уточняющие модели. Поэтому сгруппировали автомоболи по марке машины, т. е. по первому слову. Получилось всего 30 категорий. Далее были закодированы категориалльные признаки, включая переменную seats, методом OneHot-кодирования. Также числовые признаки подвергнуты масштабированию. Результаты:
   * alpha = 1;
   * качество прогнозов удалось улучшить. Раньше (во всех предыдущих моделях) значение R^2 не превышало ~0.6 для тренировочной и тестовой выборок, сейчас R^2 вырос на ~0.2 для обеих выборок. Ошибка MSE уменьшилась для обоих датасетов
     пимерно в 2 раза, что тоже указывает на улучшение качества моделей.

### Бизнес-метрика
Описание метрики: доля прогнозов цен на автомобиль, отличающихся от реальных цен на эти автомобили не более, чем на 10% (по модулю).
Реализована и посчитана бизнес-метрика для всех рассмотренных моделей:
* модель, которая лучше всего решает задачу бизнеса, - Ridge-регрессия (numeric, categorical, StandardScaler, GridSearchCV). Бизнес-метрика равна 0.3070;
* значение бизнес-метрики для других моделей не превышает 0.23.

Таким образом, существенно увеличить качество модели удалось только тогда, когда модель построена не только на числовых, но и на категориальных признаках. Несмотря на то что до построения модели гребниевой регрессии в моделях только с числовыми признаки числовые признаки подвергались масштабированию, была применена L1-регуляризация, качество предсказания не увеличилось. Данное исследование продемонстрировало важность использования категориальных признаков.

Все задания, включая бонусные, выполнены.

Дашборд находится в файле profiling_report.html.
Скриншоты работы FastAPI находятся в папке img_fastapi_ml_hw_1. 



























